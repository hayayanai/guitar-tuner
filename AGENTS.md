# AGENTS.md

## 概要
このプロジェクトのAI/自動化エージェントの役割・履歴・注意点を記載します。

### 役割
- Tauri + Vue + Rust (cpal/rustfft) ギターチューナーの自動実装・デバッグ支援
- Rustバックエンドの音声入力・FFT・イベント送信、Vue UIの自動生成
- ユーザー指示に従い、エラー修正・ログ追加・デバッグ方針提案

### 履歴
- cpalで音声入力デバイス列挙・ストリーム作成・FFT解析・イベント送信まで自動実装
- ストリーム作成・再生までは成功するが、コールバックが一度も呼ばれない問題が発生
- すべてのサンプルフォーマット (F32/I16/U16) でストリーム作成を順に試す実装に変更
- Rust側 `src-tauri/src/lib.rs` の `build_input_stream` のクロージャ渡し方・括弧の対応で構文エラー (`unexpected closing delimiter: ')'`) が発生
- **2025/11/30: 構文エラーを解消（重複コードブロックを削除）。ビルドは正常に通るようになった**
- **2025/11/30: コールバックが呼ばれない問題を解決（ストリームをグローバルに保持するよう修正）**
- ただし、cpalコールバックが呼ばれない問題は残っている（OS/ドライバ/cpalの制約の可能性）

### 注意点・引き継ぎ
- Rustのクロージャは「let buffer_clone = ...;」を事前に宣言し、「move |...| { ... }」だけをbuild_input_streamに渡すこと
- 余計なブロック「{ ... move |...| { ... } }」は絶対に使わない
- 構文エラーが出た場合は、クロージャの渡し方・カンマ・括弧の対応を最優先で見直すこと
- cpal/ドライバ/OSの制約でコールバックが呼ばれない場合もあるので、まずはビルドが通る形に直すこと
- **コールバックが呼ばれない場合の対処法**:
  - Windowsの「サウンド設定」→「録音」タブでデバイスの排他モードをOFFにする
  - 他のDAW/録音アプリを閉じて排他モードの競合を回避
  - 別の入力デバイス（Webcamマイクなど）で試す
  - cpalのバージョンを最新に上げてみる

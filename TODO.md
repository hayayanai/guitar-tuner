# ギターチューナー TODOリスト

プロジェクトのセットアップが完了しました。以下に今後の開発ステップを記載します。

## 1. 開発環境のセットアップ

- [ ] `npm install` を実行して、フロントエンドの依存関係をインストールする。
- [ ] `mise install` を実行して、指定されたNode.jsとRustのバージョンをインストールする。
- [ ] `npm run tauri dev` を実行して、開発モードでアプリケーションが起動することを確認する。

## 2. バックエンド (Rust) の実装

- [ ] `Cargo.toml` に音声入出力ライブラリ `cpal` を追加する。
- [ ] `Cargo.toml` に高速フーリエ変換ライブラリ `rustfft` を追加する。
- [ ] **音声入力デバイスの取得**:
    - [ ] `cpal` を使用して、利用可能なオーディオ入力デバイスのリストを取得するTauriコマンド (`get_audio_devices`) を実装する。
- [ ] **音声処理の開始**:
    - [ ] 選択されたデバイスIDをフロントエンドから受け取り、そのデバイスからの音声ストリームを開始するTauriコマンド (`start_listening`) を実装する。
- [ ] **音声データの解析**:
    - [ ] 音声ストリームからバッファを受け取る。
    - [ ] バッファに窓関数（ハニング窓など）を適用する。
    - [ ] `rustfft` を使って高速フーリエ変換を実行し、周波数スペクトルを得る。
    - [ ] スペクトルから最もパワーの大きい周波数（基本周波数）を特定する。
- [ ] **フロントエンドへの通知**:
    - [ ] 定期的に（例: 100msごと）、検出した基本周波数をフロントエンドに送信するイベントを実装する。

## 3. フロントエンド (Vue.js) の実装

- [ ] **UIコンポーネントの作成**:
    - [ ] アプリケーションのメインとなる `App.vue` を編集する。
- [ ] **デバイス選択機能**:
    - [ ] アプリケーション起動時に、バックエンドから音声デバイスのリストを取得し、`<select>` ドロップダウンに表示する。
    - [ ] ドロップダウンでデバイスが選択されたら、バックエンドの `start_listening` コマンドを呼び出す。
- [ ] **チューニング情報の表示**:
    - [ ] バックエンドから送信される周波数イベントを購読する。
    - [ ] 受け取った周波数に最も近い音名（例: E, A, D, G, B, E）を特定する。
    - [ ] 目標となる周波数と、実際の周波数との差（セント単位）を計算する。
    - [ ] 計算結果を視覚的に表示するUIを作成する（例: 針が左右に振れるメーター、色が変化するインジケーターなど）。
- [ ] **スタイリング**:
    - [ ] アプリケーション全体のデザインを整える。

## 4. アプリケーションの仕上げ

    - [ ] `tauri.conf.json` を編集して、タスクトレイアイコンとメニュー（表示/非表示、終了など）を設定する。
    - [ ] `src-tauri/icons` にあるデフォルトアイコンをオリジナルのものに差し替える。
    - [ ] `npm run tauri build` を実行して、配布用の実行可能ファイルを生成する。

# --- 引き継ぎ・現状の問題 ---

- ✅ Rust側 `src-tauri/src/lib.rs` の構文エラーは解消済み（重複コードブロックを削除）
- ✅ ビルドは正常に通る
- ⚠️ ストリーム作成・再生は成功するが、cpalのコールバックが一度も呼ばれない問題が残っている
- ⚠️ これはOS/ドライバ/cpalの制約による可能性があり、以下を試すべき：
  - Windowsの「サウンド設定」→「録音」タブでデバイスの排他モードをOFFにする
  - 他のDAW/録音アプリを閉じて排他モードの競合を回避
  - 別の入力デバイス（Webcamマイクなど）で試す
  - cpalのバージョンを最新に上げてみる
